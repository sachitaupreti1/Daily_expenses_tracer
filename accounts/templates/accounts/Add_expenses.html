{% extends 'accounts/base.html' %}
{% load static %}

{% block title %}Expenses{% endblock %}

{% block extra_css %}
<style>
    .expenses-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .add-expense-btn {
        background-color: #28a745;
        color: white;
        border: none;
        padding: 10px 18px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 500;
    }

    .expenses-filters {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }

    .filter-input {
        padding: 8px 10px;
        border-radius: 6px;
        border: 1px solid #ccc;
        font-size: 14px;
    }

    .expenses-table-wrapper {
        background: white;
        border-radius: 8px;
        overflow-x: auto;
    }

    .expenses-table {
        width: 100%;
        border-collapse: collapse;
    }

    .expenses-table th,
    .expenses-table td {
        padding: 12px;
        border-bottom: 1px solid #eee;
        font-size: 14px;
    }

    .expenses-table th {
        background-color: #f8f9fa;
        font-weight: 600;
    }

    .action {
        margin-right: 10px;
        font-weight: 500;
        cursor: pointer;
    }

    .action.edit { color: #007bff; }
    .action.delete { color: #dc3545; }
</style>
{% endblock %}

{% block content %}

<!-- Header -->
<div class="expenses-header">
    <h2>Expenses</h2>

  
<button class="add-expense-btn" onclick="openModal()">+ Add New Expense</button>
   


</div>

<!-- Filters -->
<div class="expenses-filters">
    <input type="text" placeholder="Search Expense..." class="filter-input">
    <select class="filter-input">
        <option>All Category</option>
    </select>
    <select class="filter-input">
        <option>All Payment Modes</option>
    </select>
    <input type="date" class="filter-input">
    <select class="filter-input">
        <option>Sort By</option>
    </select>
</div>

<!-- Table -->
<div class="expenses-table-wrapper">
    <table class="expenses-table">
        <thead>
            <tr>
                <th>#</th>
                <th>Category</th>
                <th>Date</th>
                <th>Payment Mode</th>
                <th>Total Amount</th>
                <th>Remarks</th>
                <th>Action</th>
            </tr>
        </thead>

        <tbody>
            {% for e in expenses %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ e.category }}</td>
                <td>{{ e.date }}</td>
                <td>{{ e.payment_mode }}</td>
                <td>Rs. {{ e.amount }}</td>
                <td>{{ e.remarks }}</td>
                <td>
                    <!-- âœ… URL CONNECTED -->
                    <a href="{% url 'edit_expense' e.id %}" class="action edit">Edit</a>
                    <a href="{% url 'delete_expense' e.id %}" class="action delete"
                       onclick="return confirm('Delete this expense?')">
                        Delete
                    </a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" style="text-align:center;">No expenses found</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- ADD EXPENSE MODAL -->
<div id="expenseModal" class="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
    <div class="modal-box" style="background:white; padding:30px; border-radius:10px; width:90%; max-width:500px;">
        <div class="modal-header" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h3 style="margin:0;">Add Expense</h3>
            <span onclick="closeModal()" style="font-size:30px; cursor:pointer; font-weight:bold;">&times;</span>
        </div>

        <form method="POST" action="{% url 'add_expenses' %}">
            {% csrf_token %}

            <div style="display:flex; gap:10px; margin-bottom:15px;">
                <input type="text" value="Manual" disabled style="flex:1; padding:10px; border:1px solid #ccc; border-radius:5px;">
                <input type="date" name="date" value="{{ today }}" style="flex:1; padding:10px; border:1px solid #ccc; border-radius:5px;">
            </div>

            <input type="text" name="category" placeholder="Expense Category" style="width:100%; padding:10px; border:1px solid #ccc; border-radius:5px; margin-bottom:15px;">

            <div style="display:flex; gap:10px; margin-bottom:15px;">
                <input type="number" name="amount" placeholder="Total Amount" style="flex:1; padding:10px; border:1px solid #ccc; border-radius:5px;">
                <select name="payment_mode" style="flex:1; padding:10px; border:1px solid #ccc; border-radius:5px;">
                    <option>Cash</option>
                    <option>Online</option>
                    <option>Card</option>
                </select>
            </div>

            <textarea name="remarks" placeholder="Remarks" style="width:100%; padding:10px; border:1px solid #ccc; border-radius:5px; margin-bottom:15px; min-height:80px;"></textarea>

            <div style="display:flex; gap:10px; justify-content:flex-end;">
                <button type="button" onclick="closeModal()" style="padding:10px 20px; border:1px solid #ccc; border-radius:5px; cursor:pointer; background:#f0f0f0;">Cancel</button>
                <button type="submit" class="save" style="padding:10px 20px; border:none; border-radius:5px; cursor:pointer; background:#28a745; color:white; font-weight:bold;">Save Expense</button>
            </div>
        </form>
    </div>
</div>

<script>
function openModal() {
    document.getElementById("expenseModal").style.display = "flex";
}

function closeModal() {
    document.getElementById("expenseModal").style.display = "none";
}
</script>

{% endblock %}
